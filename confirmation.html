<!DOCTYPE html>
<html>
<head>
   <!-- Google Tag Manager -->
   <script>
       (function(w,d,s,l,i){
           w[l]=w[l]||[];
           w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});
           var f=d.getElementsByTagName(s)[0],
           j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
           j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
           f.parentNode.insertBefore(j,f);
       })(window,document,'script','dataLayer','GTM-M6NJ4M2P');
   </script>
   <!-- End Google Tag Manager -->

   <!-- Impact UTT (Universal Tracking Tag) -->
   <script type="text/javascript">
       (function(a,b,c,d,e,f,g){
           e['ire_o']=c;
           e[c]=e[c]||function(){(e[c].a=e[c].a||[]).push(arguments)};
           f=d.createElement(b);
           g=d.getElementsByTagName(b)[0];
           f.async=1;
           f.src=a;
           g.parentNode.insertBefore(f,g);
       })('https://utt.impactcdn.com/A6017967-9b32-44cf-a4c7-1b76f8f0bfce65535.js','script','ire',document,window);
   </script>
   <!-- End Impact UTT -->

   <title>Order Confirmation - Shop Shoes</title>
   <link href="css/bootstrap.css" rel="stylesheet" type="text/css" media="all" />
   <script src="js/jquery.min.js"></script>
   <link href="css/style.css" rel="stylesheet" type="text/css" media="all" />

   <script>
    function getQueryParam(param) {
        let urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
    }
    
    let irclickid = getQueryParam("irclickid");
    if (irclickid) {
        // Store it in cookies or localStorage
        document.cookie = "irclickid=" + irclickid + "; path=/"; // Store in cookie
        window.localStorage.setItem('irclickid', irclickid); // Store in localStorage
        
        // Push it to GTM
        window.dataLayer = window.dataLayer || [];
        window.dataLayer.push({
            'event': 'conversion',
            'irclickid': irclickid
        });
    }
    </script>
    
</head>

<body>

   <!-- Google Tag Manager (noscript) -->
   <noscript>
       <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M6NJ4M2P"
       height="0" width="0" style="display:none;visibility:hidden"></iframe>
   </noscript>
   <!-- End Google Tag Manager (noscript) -->

   <!-- Impact Identify Function - Properly placed inside the body -->
   <script type="text/javascript">
       ire('identify', {
           customerid: '123456', // Replace with actual customer ID
           customeremail: 'B87A2BE9B52070D84D0F5A373FFB49C3440B2295' // SHA1 hashed email
       });
   </script>
   <!-- End Impact Identify -->

   <h1>Thank You for Your Purchase!</h1>
   <p>Your transaction was successful.</p>

   <h3>Order Details:</h3>
   <table>
       <tr><td><strong>Order ID:</strong></td><td id="order-id">Loading...</td></tr>
       <tr><td><strong>Customer Name:</strong></td><td>John Doe</td></tr>
       <tr><td><strong>Email:</strong></td><td>johndoe@example.com</td></tr>
       <tr><td><strong>Total Amount:</strong></td><td>$250.00</td></tr>
   </table>

   <script type="text/javascript">
	document.addEventListener("DOMContentLoaded", function() {
		// Generate Order ID
		function generateOrderId() {
			return "ORD-" + Date.now() + "-" + Math.floor(Math.random() * 1000);
		}

		// Generate the order ID
		let orderId = generateOrderId();

		// Get the irclickid from the cookies
		function getIrClickId() {
			const cookieValue = document.cookie.split('; ').find(row => row.startsWith('irclickid='));
			return cookieValue ? cookieValue.split('=')[1] : null;  // Return the value or null if not found
		}

		const irclickid = getIrClickId(); // Capture the irclickid

		// Push the conversion event and customer data to dataLayer
		window.dataLayer = window.dataLayer || [];
		window.dataLayer.push({
			'event': 'conversion_tracking',
			'orderId': orderId,  // Use the random order ID
			'irclickid': irclickid,  // Push the irclickid
			'customProfileId': "TestUUID1GJK",
			'customerId': "1123413",
			'customerEmail': "B87A2BE9B52070D84D0F5A373FFB49C3440B2295",
			'customerStatus': "New",
			'currencyCode': "USD",
			'orderPromoCode': "newshoeswhodis",
			'orderDiscount': 15.00,
			'items': [
				{
					'subTotal': 28.00,
					'category': "Shoes",
					'sku': "sku-392386",
					'quantity': 2,
					'name': "Long Shoes"
				},
				{
					'subTotal': 99.00,
					'category': "Shoes",
					'sku': "sku-85634",
					'quantity': 3,
					'name': "Strong Shoes"
				}
			]
		});

		// Impact Conversion Tracking
		ire('trackConversion', 54289, {
			orderId: orderId,  // Use the random order ID
			irclickid: irclickid,  // Pass irclickid in the conversion payload
			customerEmail: "B87A2BE9B52070D84D0F5A373FFB49C3440B2295",
			customerStatus: "New",
			currencyCode: "USD",
			orderPromoCode: "newshoeswhodis",
			orderDiscount: 15.00,
			items: [
				{
					subTotal: 28.00,
					category: "Shoes",
					sku: "sku-392386",
					quantity: 2,
					name: "Long Shoes"
				},
				{
					subTotal: 99.00,
					category: "Shoes",
					sku: "sku-85634",
					quantity: 3,
					name: "Strong Shoes"
				}
			]
		}, { verifySiteDefinitionMatch: true });

		// Optional: Log irclickid for debugging
		console.log("Generated Order ID: " + orderId);
		console.log("irclickid: " + irclickid);
		alert("Impact payload received. Order ID: " + orderId + ". irclickid: " + irclickid);
	});
</script>



   <div class="checkout-buttons">
       <a href="index.html" class="button">Continue Shopping</a>
       <a href="store.html" class="button">Go to Store</a>
   </div>

</body>
</html>

